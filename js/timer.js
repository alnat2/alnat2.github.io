let countdownRun,timers=[];const timersPredefined=["15+5+15+9+15","15*3","15+10+15","15+11+15+10+15+8+15"],nextTimers=document.getElementById("nextTimers"),displayArea=document.getElementById("displayArea"),timerInput=document.getElementById("timerInput"),timerRunButton=document.getElementById("timerRun"),timerDisplay=document.querySelector(".displayTimeLeft"),timerTotalTime=document.querySelector(".displayTimeTotal"),soundComplete=document.getElementById("complete");function countdownOver(a){a.play()}function secondsToTimeLeftString(a){const b=Math.floor(a/60),c=a%60,d=`${b}:${10>c?"0":""}${c}`;return d}function displayTimeLeft(a,b){let c=secondsToTimeLeftString(a);document.title=c,b.textContent=c}function displayTotalTime(a,b){if(1==a.length)return void(b.textContent="");let c=a.reduce((b,a)=>parseInt(b)+parseInt(a));b.textContent=`total timers time is: ${c} ${1==c?"minute":"minutes"}`}function displayPredefinedTimers(a){const{displayElement:b,container:d="select",elCls:e="display__time-predefined",arr:c}=a,f=document.createElement(d),g="select"===d?"option":"button";f.setAttribute("id","predefinedContainer");for(let b=0;b<c.length;b++){const a=document.createElement(g);Object.assign(a,{className:e,innerHTML:c[b]}),f.appendChild(a)}b.appendChild(f)}function displayNextTimers(a){const{displayElement:b,elCls:d="nextTimers__item",arr:c}=a;b.hasChildNodes()&&(b.innerHTML="");const e=document.createElement("ul");if(1==c.length){const a=document.createElement("li");Object.assign(a,{className:d,innerHTML:"No more timers"}),e.appendChild(a)}else for(let a=c.length-2;0<=a;a--){const b=document.createElement("li");b.className=d;const f=document.createElement("button");Object.assign(f,{className:"startBtn",innerHTML:c[a]}),f.setAttribute("data-arrPos",a+1-c.length);const g=document.createElement("button");Object.assign(g,{className:"deleteBtn",innerHTML:"delete"}),g.setAttribute("data-arrPos",a-c.length),b.appendChild(f),b.appendChild(g),e.appendChild(b)}b.appendChild(e)}function inputValidate(a,b){let c={};const d=new RegExp(b,"g");let e=a.match(d);return null===e?(c.valid=!0,c.data=a,c):(c.valid=!1,c.unaccept=e.join(" "),c)}function valuesToArray(a,b="+",c="*"){if(!a)return;let d=[];const e=a.split(b);for(let f=0;f<e.length;f++)if(e[f].includes(c)){let a=e[f].split(c),b=1;if(3<=a.length)for(let c=1;c<a.length;c++)b*=parseInt(a[c]);else b=parseInt(a[1]);for(;b;){if(isNaN(a[0]))return d=[],d[0]="nan",d;d.push(a[0]),b--}}else{if(isNaN(e[f]))return d=[],d[0]="nan",d;d.push(e[f])}return d.reverse(),d}function*counter(a=1){for(var b=a;;){var c=yield b;b--,c&&(b=c+1)}}function initGenerator(a){const b=a();return b.next(),b}const cdCounter=initGenerator(counter);function timeOver(){countdownOver(soundComplete),timers.pop(),0<timers.length?timeStart(timers[timers.length-1]):timerRunButton.textContent="\u25B6"}function timeStart(a){let b=60*a;clearInterval(countdownRun),displayNextTimers({arr:timers,displayElement:nextTimers}),displayTotalTime(timers,timerTotalTime),a&&(cdCounter.next(b),displayTimeLeft(b,timerDisplay)),countdownRun=setInterval(()=>{let a=cdCounter.next().value;displayTimeLeft(a,timerDisplay),0>=a&&(clearInterval(countdownRun),timeOver())},1e3)}function timersRun(a){if(timerInput.value){const b=inputValidate(timerInput.value,"[^\\d+\\*\\.]+");let c;if(!b.valid)return void(displayArea.children[2].innerHTML=`${b.unaccept} ${c=1==b.unaccept.length?"unacceptable symbol":"unacceptable symbols"}`);if(timers=valuesToArray(b.data),"nan"===timers[0])return void(displayArea.children[2].innerHTML="incorrect sequence");timerStartPause(a,timers[timers.length-1]),timerInput.value=""}else timerStartPause(a,null)}function timerStartPause(a,b){if("\u23F8"===a.target.textContent)timerRunButton.textContent="\u25B6",clearInterval(countdownRun);else{if(b===void 0)return;timeStart(b),timerRunButton.textContent="\u23F8"}}3<timersPredefined.length?displayPredefinedTimers({arr:timersPredefined,displayElement:displayArea}):displayPredefinedTimers({arr:timersPredefined,container:"div",displayElement:displayArea});const predefinedContainer=document.getElementById("predefinedContainer");predefinedContainer.addEventListener("click",a=>{if("BUTTON"===a.target.tagName)timers=valuesToArray(a.target.innerHTML);else{if(a.currentTarget===a.target&&-1!=navigator.userAgent.indexOf("Firefox"))return;timers=valuesToArray(a.currentTarget.selectedOptions[0].innerHTML)}timerStartPause(a,timers[timers.length-1])}),timerRunButton.addEventListener("click",a=>timersRun(a)),timerInput.addEventListener("keypress",a=>{"Enter"===a.key&&(a.preventDefault(),timersRun(a))}),nextTimers.addEventListener("click",a=>{const b=a.target.dataset.arrpos;"deleteBtn"===a.target.className?(timers.splice(b,1),displayNextTimers({arr:timers,displayElement:nextTimers}),displayTotalTime(timers,timerTotalTime)):"startBtn"===a.target.className&&(timers.splice(b),timerStartPause(a,timers[timers.length-1]))});