import{countdownOverSignal,displayTimeLeft,displayTotalTime,displayPredefinedTimers,displayNextTimers,inputValidate,valuesToArray,counter,initGenerator}from"./cdtLib.js";let countdownRun,timers=[];const timersPreset=["15+5+15+9+15","15*3","15+10+15","15+11+15+10+15+8+15"],nextTimers=document.getElementById("nextTimers"),displayArea=document.getElementById("displayArea"),timerInput=document.getElementById("timerInput"),timerRunButton=document.getElementById("timerRun"),timerDisplay=document.querySelector(".displayTimeLeft"),timerTotalTime=document.querySelector(".displayTimeTotal"),soundComplete=document.getElementById("complete"),cdCounter=initGenerator(counter);function timeOver(){countdownOverSignal(soundComplete),timers.pop(),0<timers.length?timeStart(timers[timers.length-1]):timerStartPause("complete")}function timeStart(a){let b=60*a;clearInterval(countdownRun),displayNextTimers({arr:timers,displayElement:nextTimers}),displayTotalTime(timers,timerTotalTime),a&&(cdCounter.next(b),displayTimeLeft(b,timerDisplay)),countdownRun=setInterval(()=>{let a=cdCounter.next().value;displayTimeLeft(a,timerDisplay),0>=a&&(clearInterval(countdownRun),timeOver())},1e3)}function timersRun(a){if(timerInput.value){const b=inputValidate(timerInput.value,"[^\\d+\\*\\.]+");let c;if(!b.valid)return void(displayArea.children[2].innerHTML=`${b.unaccept} ${c=1==b.unaccept.length?"unacceptable symbol":"unacceptable symbols"}`);if(timers=valuesToArray(b.data),"nan"===timers[0])return void(displayArea.children[2].innerHTML="incorrect sequence");timerStartPause(a,timers[timers.length-1]),timerInput.value=""}else timerStartPause(a,null)}function timerStartPause(a,b){if("complete"===a||"\u23F8"===a.target.textContent)timerRunButton.textContent="\u25B6",clearInterval(countdownRun);else{if(b===void 0)return;timeStart(b),timerRunButton.textContent="\u23F8"}}3<timersPreset.length?displayPredefinedTimers({arr:timersPreset,displayElement:displayArea}):displayPredefinedTimers({arr:timersPreset,container:"div",displayElement:displayArea});const predefinedContainer=document.getElementById("predefinedContainer");predefinedContainer.addEventListener("click",a=>{if("BUTTON"===a.target.tagName)timers=valuesToArray(a.target.innerHTML);else{if(a.currentTarget===a.target&&-1!=navigator.userAgent.indexOf("Firefox"))return;timers=valuesToArray(a.currentTarget.selectedOptions[0].innerHTML)}timerStartPause(a,timers[timers.length-1])}),timerRunButton.addEventListener("click",a=>timersRun(a)),timerInput.addEventListener("keypress",a=>{"Enter"===a.key&&(a.preventDefault(),timersRun(a))}),nextTimers.addEventListener("click",a=>{const b=a.target.dataset.arrpos;"deleteBtn"===a.target.className?(timers.splice(b,1),displayNextTimers({arr:timers,displayElement:nextTimers}),displayTotalTime(timers,timerTotalTime)):"startBtn"===a.target.className&&(timers.splice(b),timerStartPause(a,timers[timers.length-1]))});